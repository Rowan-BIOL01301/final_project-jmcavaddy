---
title: "Final Project"
subtitle: "Data Science for Biologists, Spring 2021"
author: "John McAvaddy"
output: 
  html_document:
    theme: lumen
    highlight: espresso
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
# DON'T CHANGE THE NEXT LINE, except to add NEW options if you have any.
knitr::opts_chunk$set(warning=FALSE, message=FALSE, echo = TRUE, include = TRUE)

# Load all libraries you use HERE:
library(tidyverse)
library(broom)
library(pROC)
```

<br><br>

## Introduction

I chose [data](https://github.com/rfordatascience/tidytuesday/tree/master/data/2020/2020-09-22) recorded on mountain ascents in the [Himalayan mountain range](https://en.wikipedia.org/wiki/Himalayas). I chose this data because if I could get paid to climb mountains, I would climb one every day for the rest of my life. Because of my love for climbing mountains, I thought it would be interesting to explore climbing data collected from some of the [tallest mountains](https://en.wikipedia.org/wiki/List_of_highest_mountains_on_Earth) in the world. 

```{r read-examine-data}
members <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-09-22/members.csv')
expeditions <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-09-22/expeditions.csv')
peaks <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-09-22/peaks.csv')

glimpse(members) # see data in members data set
glimpse(expeditions) # see data in expeditions data set
glimpse(peaks) # see data in peaks data set
```

<br><br>

## Question 1

#### How well does the average age of an expedition group predict whether the group successfully reached a peak?

### Methods
```{r question_one_wrangling}
# create a column of expedition group's average age
members %>%
  group_by(expedition_id) %>% # groups rows by similar values in
  summarize(average_age = mean(age)) %>% # create new column of average ages of each expedition group
  drop_na()  -> members_avg_age # 
  

# turn termination_reason column into "success" or "failure"
expeditions %>%
  mutate(termination_reason_chr = if_else(str_detect(termination_reason, "Success"),
                                          "Success",
                                          "Failure")) %>%
  mutate(termination_reason_01 = if_else(termination_reason_chr == "Success",
                                         1,
                                         0)) %>%
  select(termination_reason_01, termination_reason_chr, expedition_id) -> expd_success_chr_01

# combine table containing average_age with table containing termination_reason by expedition_id
inner_join(members_avg_age, expd_success_chr_01) %>%
  drop_na() -> expd_age_clean
```

```{r question_one_model}
# check balance for ROC
expd_age_clean %>%
  count(termination_reason_chr)

# building a model using success as response and average age as predictor
age_model <- glm(termination_reason_01 ~ average_age, data = expd_age_clean, family = "binomial")

# create ROC curve for age_model
roc(expd_age_clean$termination_reason_01, age_model$fitted.values) -> fitted_roc
```

```{r question_one_plotting}
tibble(TPR = fitted_roc$sensitivities,
       FPR = 1 - fitted_roc$specificities) %>%
  ggplot() +
  aes(x = FPR, y = TPR) +
  labs(title = "ROC curve to classify climber success",
       subtitle = paste("AUC = ",round(fitted_roc$auc, 3))) +
  geom_line() +
  geom_abline(col = "red")
```

### Answer

Replace this text with your answer to your question.


<br><br>

## Question 2

#### Are injuries more likely to occur in the upper half or lower half of the peak's height?
### Methods

### Answer

Replace this text with your answer to your question.

<br><br>

## Question 3

#### In which season are climbers most likely to succeed?

### Methods

### Answer

Replace this text with your answer to your question.


<br><br>

## Question 4

#### Considering only the first expedition groups to arrive at a given peak, which peak experienced the youngest average aged climbers?

Which peak had the youngest average age of the first expedition group at its peak?

### Methods

### Answer

Replace this text with your answer to your question.
